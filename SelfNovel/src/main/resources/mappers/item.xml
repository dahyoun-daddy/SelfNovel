<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sn.item.repository.mappers.item">
	
	<!-- 일반 저장(Insert) -->
	<insert id="do_save" parameterType="com.sn.resume.domain.ItmVO">
		INSERT INTO item (
					    rsm_id,
					    itm_form_id,    
					    itm_title,
					    itm_content,
					    u_id,
					    itm_reg_dt,
					    itm_seq,
					    itm_use_yn
					) VALUES (
					    #{rsm_id},
					    ITEM_SEQ.NEXTVAL,    
					    #{itm_title},
					    #{itm_content},
					    #{u_id},
					    sysdate,
					    #{itm_seq},
					    1
					)
	</insert>
	
	<!-- 첨삭 저장(Insert) -->
	<insert id="do_save_edit" parameterType="com.sn.resume.domain.ItmVO">
		INSERT INTO item (
					    rsm_id,
					    itm_form_id,
					    itm_prd_id,  
					    itm_title,
					    itm_content,
					    u_id,
					    itm_reg_dt,
					    itm_seq,
					    itm_use_yn
					) VALUES (
					    #{rsm_id},				    
					    ITEM_SEQ.NEXTVAL,
					    #{itm_prd_id},    
					    #{itm_title},
					    #{itm_content},
					    #{u_id},
					    sysdate,
					    #{itm_seq},
					    1
					)
	</insert>	
	
	<!-- 삭제(Delete) : 실제 삭제는 이루어지지 않고, 플래그만 UPDATE -->
	<update id="do_delete" parameterType="com.sn.resume.domain.ItmVO">		
		UPDATE item
		   SET itm_use_yn = 0
		WHERE itm_form_id =#{itm_form_id}
	</update>	
	
	<!-- 수정(Update) -->
	<update id="do_update" parameterType="com.sn.resume.domain.ItmVO">		
		UPDATE item
		   SET itm_title = #{itm_title},
		       itm_content =#{itm_content},       
		       itm_seq = #{itm_seq}       
		WHERE itm_form_id = #{itm_form_id}
	</update>
	
	<!-- 조회(Search) -->
	<select id="do_search" parameterType="com.sn.resume.domain.ItmVO"
							  resultType="com.sn.resume.domain.ItmVO">
		SELECT *
		  FROM ( 
                SELECT I.RSM_ID,
                       I.ITM_FORM_ID,
                       I.ITM_PRD_ID,
                       I.ITM_TITLE,       
                       I.ITM_CONTENT,
                       I.U_ID,               
                       U.U_NAME,
                       I.ITM_REG_DT,
                       I.ITM_SEQ,
                       I.ITM_USE_YN
                  FROM ITEM I, USERS U
                 WHERE I.U_ID = U.U_ID  
                ) T1
        WHERE T1.RSM_ID = #{rsm_id}
		  AND T1.ITM_USE_YN = 1		            
		START WITH T1.ITM_PRD_ID IS NULL
		CONNECT BY PRIOR T1.ITM_FORM_ID = T1.ITM_PRD_ID
        ORDER SIBLINGS BY T1.ITM_SEQ
	</select>
	
	<!-- 작성자 기반 조회(Search) -->
	<select id="do_search_expert" parameterType="com.sn.resume.domain.ItmVO"
							  resultType="com.sn.resume.domain.ItmVO">
		SELECT rsm_id,
		       itm_form_id,
		       itm_prd_id,
		       itm_title,       
		       itm_content,
		       u_id,
		       itm_reg_dt,
		       itm_seq,
		       itm_use_yn
		FROM item
		WHERE u_id = #{u_id}
		  AND itm_use_yn = 1
		START WITH itm_prd_id IS NULL
		CONNECT BY PRIOR itm_form_id = itm_prd_id 
	</select>
</mapper>    